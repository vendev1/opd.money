var LT;(()=>{"use strict";var e={};function t(e,t){let n=String(e),o=Number(t),a=n.indexOf(".");return a<0?n+"0".repeat(o):n.substring(0,a)+(n.length-a-1>=o?n.substring(a+1,a+1+o):n.substring(a+1)+"0".repeat(o-(n.length-a-1)))}(e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e);let n="",o=new Map;async function a(e,t){try{let e;if(e.ok){let t=await e.json();return console.log("INFO getLoans(): loans.size="+t.length+", loans="+JSON.stringify(t)),t}console.log("ERROR getLoans(): can't get loans")}catch(e){console.log("ERRROR getLoans(): "+JSON.stringify(e))}}const l="/opd_money/img/tokens/",s={message:"Connect your wallet",type:"is-danger"},d={message:"Copied to clipboard",type:"is-info"};function i(){let e=event.currentTarget.querySelector(".fas");event.currentTarget.parentElement.querySelector(".is-collapsible").classList.toggle("is-active"),e.classList.toggle("fa-angle-down"),e.classList.toggle("fa-angle-up")}async function m(e){var t;await async function(){n=""}(),n&&(document.getElementById("divConnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML=(t=n)&&t.length>14?t.substring(0,7)+"..."+t.substring(t.length-4):t,document.getElementById("divDisconnect").classList.remove("is-hidden"))}function c(e){if(e){let t=e.innerHTML;t&&t.length>10&&k(t)}else n&&k(n)}async function r(){let e=document.getElementById("mdButton");e.classList.add("is-loading");let t=e.getAttribute("data-id");console.log("INFO doDeal(): id="+t);let n=o.get("dataTable");if(t&&n){let e=n.get(t);if(e){let n=await async function(e,t,n,a){if(!o.get("tokens").get(n))return null;try{let e;if(console.log("INFO closeDeal(): result="+e),e)return e}catch(e){console.log("ERRROR closeDeal(): "+e)}}(0,e.borrower,e.loan_token_id,(Number(e.loan_amount),Number(e.reward)));n&&(T(n),document.getElementById("mydeal"+t).remove())}else console.log("ERROR doDeal(): there is no deal value for id="+t)}else console.log("ERROR doDeal(): there is no deal id or data");document.getElementById("modalDeal").classList.remove("is-active"),e.classList.remove("is-loading")}function g(e){let t=o.get("tokens");if("loan"===e){let e=document.getElementById("mmlLoanToken").value;e&&e>=0?(document.getElementById("mmlLoanTokenImage").setAttribute("src",l+t.get(e).name+".png"),document.getElementById("mmlRewardTokenImage").setAttribute("src",l+t.get(e).name+".png"),"XTZ"===t.get(e).name?document.getElementById("mmlLoanTokenAddress").innerHTML="&nbsp;":document.getElementById("mmlLoanTokenAddress").innerHTML=t.get(e).address):(document.getElementById("mmlLoanTokenImage").setAttribute("src",""),document.getElementById("mmlRewardTokenImage").setAttribute("src",""),document.getElementById("mmlLoanTokenAddress").innerHTML="&nbsp;")}else if("deposit"===e){let e=document.getElementById("mmlDepositToken").value;e&&e>=0?(document.getElementById("mmlDepositTokenImage").setAttribute("src",l+t.get(e).name+".png"),"XTZ"===t.get(e).name?document.getElementById("mmlDepositTokenAddress").innerHTML="&nbsp;":document.getElementById("mmlDepositTokenAddress").innerHTML=t.get(e).address):(document.getElementById("mmlDepositTokenImage").setAttribute("src",""),document.getElementById("mmlDepositTokenAddress").innerHTML="&nbsp;")}}function u(){let e=document.getElementById("mmlLoanAmount").value,t=document.getElementById("mmlRewardAmount").value,n=document.getElementById("mmlTime").value;isNaN(e)||isNaN(parseFloat(e))||isNaN(t)||isNaN(parseFloat(t))||isNaN(n)||isNaN(parseFloat(n))?document.getElementById("mmlAPR").innerHTML="-":document.getElementById("mmlAPR").innerHTML=(100*t*365/n/e).toFixed(2)}async function y(){R(),v(),document.getElementById("contentLoans").classList.remove("is-hidden");let e=document.getElementById("tblLoans");e.innerHTML="";let t=new Map;o.set("dataTable",t);let s=await a();if(s&&s.length>0){let a,d,i,m,c,r=o.get("tokens"),g="";for(let e=0;e<s.length;e++)a=s[e].key,d=s[e].value,d.borrower!==n&&(i=r.get(d.loan_token_id),m=r.get(d.deposit_token_id),c=Math.ceil(d.time/86400),t.set(a,d),g+='<tr id="loan'+a+'" data-id="'+a+'" class="is-clickable"><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+i.name+'.png"></figure><span class="has-text-weight-semibold">'+i.name+"</span></td><td>"+p(d.loan_amount,i)+"</td><td>"+p(d.reward,i)+"</td><td>"+c+(1===c?" day":" days")+'</td><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+m.name+'.png"></figure><span class="has-text-weight-semibold">'+m.name+"</span>&nbsp;"+p(d.deposit_amount,m)+"</td></tr>");e.innerHTML=g}}async function L(e){if(!n)return void bulmaToast.toast(s);let t=event.target.closest("tr");if(!t)return void console.log("ERROR showLoan(): there is no TR element");let a=t.getAttribute("data-id");if(console.log("INFO showLoan(): id="+a),console.log("INFO showLoan(): action="+e),"cancelLoan"!==e&&"makeDeal"!==e)return void console.log("ERROR showLoan(): invalid action");let d=o.get("dataTable");if(a&&d){let t=d.get(a);if(t){let s=o.get("tokens").get(t.loan_token_id),d=o.get("tokens").get(t.deposit_token_id),i=Math.ceil(t.time/86400);document.getElementById("mlLoanTokenImg").setAttribute("src",l+s.name+".png"),document.getElementById("mlLoanTokenName").innerHTML=s.name,document.getElementById("mlLoanAmount").innerHTML=I(t.loan_amount,s),document.getElementById("mlRewardTokenImg").setAttribute("src",l+s.name+".png"),document.getElementById("mlRewardTokenName").innerHTML=s.name,document.getElementById("mlRewardAmount").innerHTML=I(t.reward,s),document.getElementById("mlTime").innerHTML=i+"&nbsp;"+(1===i?"day":"days"),document.getElementById("mlValidity").innerHTML=f(t.validity),document.getElementById("mlDepositTokenImg").setAttribute("src",l+d.name+".png"),document.getElementById("mlDepositTokenName").innerHTML=d.name,document.getElementById("mlDepositAmount").innerHTML=I(t.deposit_amount,d);let m=document.getElementById("mlTitle"),c=document.getElementById("mlButton");c.setAttribute("data-id",a),c.removeEventListener("click",E),c.removeEventListener("click",b),c.classList.remove("is-loading"),c.removeAttribute("disabled"),"cancelLoan"===e?(m.innerHTML="My loan request",c.innerHTML="Cancel request",c.addEventListener("click",E)):"makeDeal"===e&&(m.innerHTML="Loan request",c.innerHTML="Lend",n===t.borrower?c.setAttribute("disabled",""):c.addEventListener("click",b)),document.getElementById("modalLoan").classList.add("is-active")}else console.log("ERROR showLoan(): there is no loan value for id="+a)}else console.log("ERROR showLoan(): there is no loan id or data for action="+e)}async function E(){let e=document.getElementById("mlButton"),t=e.getAttribute("data-id");if(console.log("INFO doCancelLoan(): id="+t),t){e.classList.add("is-loading");let n=await async function(e){try{let e;if(console.log("INFO cancelLoan(): result="+e),e)return e}catch(e){console.log("ERRROR cancelLoan(): "+e)}}();n&&(T(n),document.getElementById("myloan"+t).remove())}else console.log("ERROR doCancelLoan(): there is no loan id");document.getElementById("modalLoan").classList.remove("is-active"),e.classList.remove("is-loading")}async function b(){if(!n)return void bulmaToast.toast(s);let e=document.getElementById("mlButton");e.classList.add("is-loading");let t=e.getAttribute("data-id");console.log("INFO doMakeDeal(): id="+t);let a=o.get("dataTable");if(t&&a){let e=a.get(t);if(e){let n=await async function(e,t,n){if(!o.get("tokens").get(t))return null;try{let e;if(console.log("INFO makeDeal(): result="+e),e)return e}catch(e){console.log("ERRROR makeDeal(): "+e)}}(0,e.loan_token_id,e.loan_amount);n&&(T(n),document.getElementById("loan"+t).remove())}else console.log("ERROR doMakeDeal(): there is no loan value for id="+t)}else console.log("ERROR doMakeDeal(): there is no loan id or data");document.getElementById("modalLoan").classList.remove("is-active"),e.classList.remove("is-loading")}function f(e){return e?new Date(Date.parse(e)).toLocaleString():"&infin;"}function I(e,t){return t?e/10**t.decimals:e}function p(e,t){return t?Math.round(e/10**(t.decimals-4))/1e4:e}function T(e){bulmaToast.toast({message:"Your request is processing with ID "+e,duration:7e3,type:"is-info"})}function R(){document.getElementById("btnBurger").classList.remove("is-active"),document.getElementById("navbarMenu").classList.remove("is-active")}function v(){document.getElementById("contentMyDeals").classList.add("is-hidden"),document.getElementById("contentMyLoans").classList.add("is-hidden"),document.getElementById("contentLoans").classList.add("is-hidden"),document.getElementById("contentInfo").classList.add("is-hidden")}function k(e){if(navigator.clipboard)return navigator.clipboard.writeText(e).then((function(){}),(function(e){console.log("ERROR copyToClipboard(): "+e)})),void bulmaToast.toast(d);var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),bulmaToast.toast(d)}catch(e){console.log("ERROR copyToClipboard(): "+e)}document.body.removeChild(t)}bulmaToast.setDefaults({duration:5e3,position:"bottom-left",dismissible:!0,animate:{in:"zoomIn",out:"zoomOut"}}),document.addEventListener("DOMContentLoaded",(async function(){await async function(){try{let e;if(e.ok){let t=await e.json();console.log("INFO loadStorageData(): time="+JSON.stringify(t)),o.set("time",t)}else console.log("ERROR loadStorageData(): can't get time")}catch(e){console.log("ERRROR loadStorageData(): "+e)}try{let e;if(e.ok){let t=await e.json();console.log("INFO loadStorageData(): tokens="+JSON.stringify(t));let n=new Map;if(t&&t.length>0)for(let e=0;e<t.length;e++)n.set(t[e].key,t[e].value);o.set("tokens",n)}else console.log("ERROR loadStorageData(): can't get tokens")}catch(e){console.log("ERRROR loadStorageData(): "+e)}}();let e=o.get("tokens"),t='<option value="" selected="">[select token]</option>';if(e)for(let n of e.keys())e.get(n).active&&(t+='<option value="'+n+'">'+e.get(n).name+"</option>");document.getElementById("mmlLoanToken").innerHTML=t,document.getElementById("mmlDepositToken").innerHTML=t,y(),m()})),document.getElementById("btnMyDeals").addEventListener("click",(()=>async function(){R(),v();let e=document.getElementById("tblMyDeals");e.innerHTML="",document.getElementById("contentMyDeals").classList.remove("is-hidden");let t=new Map;if(o.set("dataTable",t),!n)return void bulmaToast.toast(s);let a=await async function(){try{let e;if(e.ok){let t=await e.json();return console.log("INFO getDeals(): deals="+JSON.stringify(t)),t}console.log("ERROR getDeals(): can't get deals")}catch(e){console.log("ERRROR getDeals(): "+JSON.stringify(e))}}();if(a&&a.length>0){let s,d,i,m,c,r,g,u,y=o.get("tokens"),L="";for(let e=0;e<a.length;e++)i=a[e].key,m=a[e].value,s=y.get(m.loan_token_id),d=y.get(m.deposit_token_id),c=m.borrower===n,r=m.creditor===n,g=Math.ceil((Date.parse(m.exp)-Date.now())/864e5),u=c||r&&g<=0,(c||r)&&(t.set(i,m),L+='<tr id="mydeal'+i+'" data-id="'+i+'" class="is-clickable'+(g<0?" has-background-danger-light":"")+'"><td class="is-clickable"><span class="icon"><i class="fas fa-hand-holding-dollar"'+(r?' style="transform: rotate(180deg)':"")+'"></i></span></td><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+s.name+'.png"></figure><span class="has-text-weight-semibold">'+s.name+"</span></td><td>"+p(m.loan_amount,s)+"</td><td>"+p(m.reward,s)+"</td><td>"+g+(1===g?" day":" days")+'</td><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+d.name+'.png"></figure><span class="has-text-weight-semibold">'+d.name+"</span>&nbsp;"+p(m.deposit_amount,d)+"</td></tr>");e.innerHTML=L}}())),document.getElementById("btnMyLoans").addEventListener("click",(()=>async function(){R(),v();let e=document.getElementById("tblMyLoans");e.innerHTML="",document.getElementById("contentMyLoans").classList.remove("is-hidden");let t=new Map;if(o.set("dataTable",t),!n)return void bulmaToast.toast(s);let d=await a();if(d&&d.length>0){let n,a,s,i,m,c=o.get("tokens"),r="";for(let e=0;e<d.length;e++)n=d[e].key,a=d[e].value,s=c.get(a.loan_token_id),i=c.get(a.deposit_token_id),m=Math.ceil(a.time/86400),t.set(n,a),r+='<tr id="myloan'+n+'" data-id="'+n+'" class="is-clickable"><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+s.name+'.png"></figure><span class="has-text-weight-semibold">'+s.name+"</span></td><td>"+p(a.loan_amount,s)+"</td><td>"+p(a.reward,s)+"</td><td>"+m+(1===m?" day":" days")+'</td><td><figure class="image is-24x24 mr-1 is-pulled-left"><img src="'+l+i.name+'.png"></figure><span class="has-text-weight-semibold">'+i.name+"</span>&nbsp;"+p(a.deposit_amount,i)+"</td><td>"+f(a.validity)+"</td></tr>";e.innerHTML=r}}())),document.getElementById("btnLoans").addEventListener("click",(()=>y())),document.getElementById("btnInfo").addEventListener("click",(()=>(R(),v(),void document.getElementById("contentInfo").classList.remove("is-hidden")))),document.getElementById("btnConnect").addEventListener("click",(()=>m())),document.getElementById("btnCopyAddress").addEventListener("click",(()=>c())),document.getElementById("btnDisconnect").addEventListener("click",(()=>async function(){await async function(){n=""}(),n||(document.getElementById("divDisconnect").classList.add("is-hidden"),document.getElementById("aAddress").innerHTML="",document.getElementById("divConnect").classList.remove("is-hidden"),y())}())),document.getElementById("tblMyDeals").addEventListener("click",(()=>async function(){let e=event.target.closest("tr");if(!e)return void console.log("ERROR showDeal(): there is no TR element");let t=e.getAttribute("data-id");console.log("INFO showDeal(): id="+t);let a=o.get("dataTable");if(t&&a){let e=a.get(t);if(e){let a=o.get("tokens").get(e.loan_token_id),s=o.get("tokens").get(e.deposit_token_id),d=e.borrower===n,i=(Date.parse(e.exp)-Date.now())/864e5;document.getElementById("mdLoanTokenImg").setAttribute("src",l+a.name+".png"),document.getElementById("mdLoanTokenName").innerHTML=a.name,document.getElementById("mdLoanAmount").innerHTML=I(e.loan_amount,a),document.getElementById("mdRewardTokenImg").setAttribute("src",l+a.name+".png"),document.getElementById("mdRewardTokenName").innerHTML=a.name,document.getElementById("mdRewardAmount").innerHTML=I(e.reward,a);let m=document.getElementById("mdTime");m.innerHTML=Math.ceil(i)+"&nbsp;"+(1===Math.abs(Math.ceil(i))?"day":"days"),i<0?m.classList.add("has-text-danger"):m.classList.remove("has-text-danger"),document.getElementById("mdDepositTokenImg").setAttribute("src",l+s.name+".png"),document.getElementById("mdDepositTokenName").innerHTML=s.name,document.getElementById("mdDepositAmount").innerHTML=I(e.deposit_amount,s);let c=document.getElementById("mdTitle"),g=document.getElementById("mdButton");g.setAttribute("data-id",t),g.removeEventListener("click",r),g.classList.remove("is-loading"),g.removeAttribute("disabled"),d?(document.getElementById("mdSumTokenImg").setAttribute("src",l+a.name+".png"),document.getElementById("mdSumTokenName").innerHTML=a.name,document.getElementById("mdSumAmount").innerHTML=I(Number(e.loan_amount)+Number(e.reward),a),c.innerHTML="Repay",g.innerHTML="Repay",g.addEventListener("click",r)):(document.getElementById("mdSumTokenImg").setAttribute("src",l+s.name+".png"),document.getElementById("mdSumTokenName").innerHTML=s.name,document.getElementById("mdSumAmount").innerHTML=I(Number(e.deposit_amount),s),c.innerHTML="Withdrawal",g.innerHTML="Take it",i<=0?g.addEventListener("click",r):g.setAttribute("disabled","")),document.getElementById("modalDeal").classList.add("is-active")}else console.log("ERROR showDeal(): there is no deal value for id="+t)}else console.log("ERROR showDeal(): there is no deal id or data")}())),document.getElementById("tblMyLoans").addEventListener("click",(()=>L("cancelLoan"))),document.getElementById("tblLoans").addEventListener("click",(()=>L("makeDeal"))),document.getElementById("btnNewMyLoan").addEventListener("click",(()=>async function(){document.getElementById("mmlButton").classList.remove("is-loading"),document.getElementById("modalMyLoan").classList.add("is-active"),bulmaToast.toast(s)}())),document.getElementById("mmlLoanToken").addEventListener("change",(()=>g("loan"))),document.getElementById("mmlDepositToken").addEventListener("change",(()=>g("deposit"))),document.querySelectorAll(".js-calc-apr").forEach((function(e){e.onchange=u})),document.getElementById("mmlLoanTokenAddress").addEventListener("click",(()=>c(event.currentTarget))),document.getElementById("mmlDepositTokenAddress").addEventListener("click",(()=>c(event.currentTarget))),document.getElementById("mmlButton").addEventListener("click",(()=>async function(){let e=document.getElementById("mmlButton");e.classList.add("is-loading");let a=document.getElementById("mmlLoanToken").value,l=document.getElementById("mmlLoanAmount").value,s=document.getElementById("mmlRewardAmount").value,d=document.getElementById("mmlTime").value,i=document.getElementById("mmlDepositToken").value,m=document.getElementById("mmlDepositAmount").value,c=document.getElementById("mmlValidity").value;console.log("---\n"),console.log("loanTokenId="+a),console.log("loanAmount="+l),console.log("rewardAmount="+s),console.log("time="+d),console.log("depositTokenId="+i),console.log("depositAmount="+m),console.log("validity="+c),console.log("---\n");let r=o.get("tokens"),g=!1;r&&r.get(a)||(console.log("ERROR doAddLoan(): loan token has to be selected"),bulmaToast.toast({message:"Select <b>loan asset</b>",type:"is-danger"}),g=!0),l&&l>0||(console.log("ERROR doAddLoan(): loan amount has to be a number in (0, inf)"),bulmaToast.toast({message:"Enter <b>loan amount</b> in (0, inf)",type:"is-danger"}),g=!0),s&&s>=0||(console.log("ERROR doAddLoan(): reward amount has to be a number in [0, inf)"),bulmaToast.toast({message:"Enter <b>reward amount</b> in [0, inf)",type:"is-danger"}),g=!0);let u=86400;if(d=Math.floor(d*u),d&&d>=o.get("time").min&&d<=o.get("time").max||(console.log("ERROR doAddLoan(): time has to be in ["+o.get("time").min/u+", "+o.get("time").max/u+"] days"),bulmaToast.toast({message:"Loan term has to be in ["+o.get("time").min/u+", "+o.get("time").max/u+"] days",type:"is-danger"}),g=!0),r.get(i)||(console.log("ERROR doAddLoan(): deposit token has to be selected"),bulmaToast.toast({message:"Select <b>collateral asset</b>",type:"is-danger"}),g=!0),a&&a===i&&(console.log("ERROR doAddLoan(): loan and deposit tokens have to be different"),bulmaToast.toast({message:"<b>Loan</b> and <b>collateral assets</b> have to be different",type:"is-danger"}),g=!0),m&&m>=0||(console.log("ERROR doAddLoan(): deposit amount has to be a number in [0, inf)"),bulmaToast.toast({message:"Enter <b>collateral amount</b> in [0, inf)",type:"is-danger"}),g=!0),c&&Math.floor(new Date(c).getTime()/6e4)<=Math.floor(Date.now()/6e4)&&(console.log("ERROR doAddLoan(): validity has to be later than the current moment"),bulmaToast.toast({message:"<b>Validity</b> has to be later than the current moment",type:"is-danger"}),g=!0),!g&&n){let e=await async function(e,n,a,l,s,d,i){let m=o.get("tokens").get(e),c=o.get("tokens").get(s);if(n=t(n,m.decimals),a=t(a,m.decimals),d=t(d,c.decimals),l>=o.get("time").min&&l<=o.get("time").max&&!(i&&Math.floor(new Date(i).getTime()/6e4)<=Math.floor(Date.now()/6e4)))try{let e;if(console.log("INFO addLoan(): result="+e),e)return e}catch(e){console.log("ERRROR addLoan(): "+e)}}(a,l,s,d,i,m,c);e&&(T(e),document.getElementById("modalMyLoan").classList.remove("is-active"))}e.classList.remove("is-loading")}())),document.querySelectorAll(".js-faq-item").forEach((function(e){e.onclick=i})),LT=e})();